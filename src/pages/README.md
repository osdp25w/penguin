# Penguin Dashboard 🐧🚴

**Penguin Dashboard** 是一個針對運動單車／電動自行車數據的管理儀表板應用程式。它提供車輛監控、電池健康狀態、警報通知以及資料分析等功能，並內建模擬 API 供開發測試使用。專案採用 JWT 憑證進行使用者登入和權限控制，可讓不同角色的使用者（管理員、管理者、一般用戶）登入後看到對應的功能。

## 專案簡介與用途說明

本專案的目的是提供一個**電單車車隊管理**的前端介面。透過此儀表板，管理者可以：

* 瀏覽**總覽儀表板**：查看線上車輛數、總行駛距離、減碳量等關鍵指標。
* 使用**即時地圖**：在地圖上監控車隊中各車輛的位置（整合 Google 地圖 API）。
* 查看**車輛列表**：以表格方式檢視所有車輛資訊（名稱、電量狀態 SOC 等），並支援分頁瀏覽。
* 檢視**電池健康**：列出車隊電池的健康度、循環次數、溫度等資訊。
* 接收**警報通知**：即時查看車輛警報（例如過熱、異常訊號）。
* 使用**機器學習分析**：輸入參數獲得預測結果，例如路線規劃建議、預估行程時間與能耗、減碳量以及電池故障風險等。
* **使用者管理**：只有管理員可訪問的頁面，用於管理使用者帳號與角色（新增帳號、設定角色權限、啟用/停用帳號）。

此專案在開發環境下利用 Mock Service Worker (MSW) 模擬後端 API，讓開發者不需後端服務即可測試完整功能。在正式部署時，前端可對接真實的後端 REST API（或繼續使用 MSW 模擬）。整體而言，Penguin Dashboard 提供了**車隊數據的視覺化介面**以及**基本的後臺管理功能**，方便開發者和使用者監控及分析車隊運行情況。

## 技術架構

本專案採用現代 Web 前後端分離架構，主要技術組成如下：

* **前端框架**：Vue 3（使用 Composition API 及 `<script setup>` 語法）。利用 Vue Router 實現單頁應用路由、以 Pinia 管理全局狀態。前端語言為 TypeScript，提供靜態型別檢查，並使用 Vue官方的 `vue-tsc` 進行專案型別檢查。
* **介面與樣式**：使用 UnoCSS 作為原子化 CSS 引擎，提供類似 Tailwind 的實用工具樣式。套用 Headless UI 元件庫（如對話框、下拉選單）增強 UI 體驗，並使用 Lucide Vue 圖示庫顯示向量圖示。圖表部分採用 Apache ECharts，透過 `vue-echarts` 套件整合於 Vue 中。
* **資料與狀態管理**：Pinia 用於前端狀態管理，區分模組（例如 `auth`、`users`、`vehicles` 等 store）管理各類資料。透過 Pinia，我們實現了集中式的登入狀態、車輛清單、電池資訊等狀態管理，方便元件之間共享資料。
* **後端 API 架構**：前端以**RESTful API**模式與後端通信。預期的 API 路徑皆以 `/api/v1/` 開頭，區分不同資源（auth、vehicles、metrics、ml 等）。開發模式下使用 **Mock Service Worker (MSW)** 攔截這些 API 請求並返回假資料。MSW 結合 Faker 庫產生隨機模擬數據，如假車輛ID、數值等。**JWT**（JSON Web Token）用於身份驗證：使用者登入成功後會取得 JWT token，之後對受保護的 API 請求應攜帶此 token（本專案中儲存在 localStorage，未來可在請求標頭加入 Authorization）。
* **基礎設施與部署**：開發環境使用 Vite 作為開發伺服器與構建工具。專案提供 Docker 支援：使用多階段建置的 Dockerfile，把前端應用打包成 Nginx 容器供生產環境部署。Docker Compose 腳本則定義了服務執行參數（例如容器名稱、埠對映等）。資料庫部分**不包含在此前端專案中**；實際資料儲存預期由後端服務及其資料庫（例如 MySQL、MongoDB 等）處理。本專案著重於前端展示與操作，後端和資料庫實作需由相應的後端服務提供。

## 安裝與啟動方式

以下是開發環境下安裝與執行此專案的步驟，以及使用 Docker 部署的方式：

### 開發環境

1. **環境準備**：請確保已安裝 Node.js（建議版本 18 以上）與套件管理工具 npm 或 yarn。建議使用 `pnpm` 以獲得更快的安裝速度（若未安裝可經由 npm 安裝：`npm install -g pnpm`）。

2. **取得原始碼**：Clone 此專案到本地端目錄：

   ```bash
   git clone https://github.com/osdp25w/penguin.git
   cd penguin
   ```

3. **安裝相依套件**：在專案目錄下執行安裝指令：

   ```bash
   pnpm install    # 或使用 npm install / yarn install
   ```

   這將安裝前端所需的所有依賴套件。

4. **設定環境變數**：在根目錄下建立一個 `.env` 檔案，並填入必要的環境變數（詳見下節「環境變數設定」）。特別是在開發時，若需使用 Google 地圖與模擬 API，請提供對應的 API 金鑰與設定。

5. **啟動開發伺服器**：執行以下命令啟動 Vite 開發伺服器：

   ```bash
   npm run dev     # 或執行 pnpm dev / yarn dev
   ```

   預設開發伺服器會監聽在 \*\*[http://localhost:5173\*\*:contentReference\[oaicite:29\]{index=29}。執行後可在瀏覽器中開啟此網址檢視應用。開發模式下會自動啟用](http://localhost:5173**:contentReference[oaicite:29]{index=29}。執行後可在瀏覽器中開啟此網址檢視應用。開發模式下會自動啟用) MSW 模擬 API，無須後端服務即可測試各功能。

6. **建立正式版本**（選擇性）：如需產生可部署的靜態資源，執行：

   ```bash
   npm run build
   ```

   此命令將進行程式碼型別檢查與優化並產出 `dist/` 目錄，其中包含可供部署的靜態前端資源。完成後可透過 `npm run preview` 在本地驗證建置後的應用。

### Docker 容器部署

專案提供了 Docker 支援，方便在生產環境部署。您有兩種方式可以使用 Docker：

* **使用 Docker Compose**：確保已安裝 Docker 与 Docker Compose，然後在專案根目錄執行：

  ```bash
  docker compose up --build
  ```

  此指令將根據 `docker-compose.yml` 建立映像並啟動容器。預設會將容器內的 Nginx 80 埠映射到本機的 8081 埠。完成後，可透過瀏覽器訪問 **[http://localhost:8081](http://localhost:8081)** 來使用應用程式。

* **使用 Docker 指令**：您也可以手動使用 Dockerfile 建立映像：

  1. 建立映像：

     ```bash
     docker build -t penguin-dashboard .
     ```
  2. 執行容器：

     ```bash
     docker run -d -p 8080:80 --name penguin_front penguin-dashboard
     ```

     以上將映像以背景模式執行，並將容器的 80 埠對應到主機的 8080 埠。部署完成後，可從瀏覽器連線到 **[http://localhost:8080](http://localhost:8080)** 觀看網站。

Docker 映像採用 Nginx 伺服器來提供前端靜態檔案。如果需要修改 Nginx 設定（例如反向代理 API 請求至後端服務），可以編輯專案內的 `nginx.conf` 後重新建置映像。當前的設定已預先支援單頁應用路由，未匹配的請求都會回傳 `index.html`。

## API 文件與使用方式

本專案採用 RESTful 風格的 API。以下列出主要的 API 路由及其用途：

* **使用者驗證**：

  * `POST /api/v1/auth/login` – 使用者登入，提交帳號（email）和密碼，回傳包含 JWT 權杖和使用者資訊的 JSON。範例回應：

    ```json
    {
      "token": "<JWT token>",
      "user": {
        "id": "u_abcdef12",
        "name": "admin",
        "email": "admin@example.com",
        "roleId": "admin"
      }
    }
    ```
* **概要統計**：

  * `GET /api/v1/metrics/summary` – 獲取儀表板概要數據，如在線車輛數、總里程、累計減碳量等。
* **車輛管理**：

  * `GET /api/v1/vehicles?page={n}&size={m}` – 分頁獲取車輛列表。支援查詢參數 `page`（頁碼）與 `size`（每頁筆數），回傳車輛清單陣列及總數。
  * `GET /api/v1/batteries` – 獲取所有車輛電池健康資訊。每個項目包含電池ID、所屬車輛、健康度%、充放電循環次數、溫度、最近更新時間等。
  * `GET /api/v1/alerts` – 獲取當前所有警報訊息。每則警報包含車輛ID、嚴重程度（資訊/警告/嚴重）、訊息描述以及時間戳記等。
* **使用者與角色** (系統管理功能，需要管理員權限)：

  * `GET /api/v1/users` – 獲取使用者帳號列表。回傳陣列包含每個使用者的 email、姓名、角色、啟用狀態、建立日期、最近登入時間等。
  * `GET /api/v1/roles` – 獲取系統中可用的角色列表與說明。每個角色包含角色ID、名稱、描述及權限範圍。
  * （*註：* 新增/修改使用者的 API 如 `POST /api/v1/users` 等在本專案中僅以前端模擬，實際環境應由後端實作相應的建立、更新、刪除 API。前端程式碼中對新增/編輯使用者的操作目前直接修改前端狀態，未真正呼叫後端。）
* **機器學習預測** (提供數據分析的小工具)：

  * `POST /api/v1/ml/strategy` – 路線規劃建議。提交目標距離（公里），回傳建議的路線坐標陣列（polyline）以及預估騎行時間和能耗。
  * `POST /api/v1/ml/carbon` – 環保效益預估。提交行駛距離，回傳預計減少的碳排放量（公斤）。
  * `POST /api/v1/ml/power` – 電力消耗預估。提交當前速度，回傳每小時耗電量（kWh）及何時需要下一次充電的建議。
  * `GET /api/v1/ml/battery` – 電池故障風險分析。回傳所有車輛電池的健康指數與預測故障概率列表。

上述路由在開發模式中由 MSW 攔截並返回模擬資料。在生產環境中，前端將對這些路徑發送真正的 HTTP 請求，因此部署後需確保**後端服務**提供相同路徑的 API。若前端與後端部署在不同網域，請設定適當的 CORS 或在前端調整 `VITE_API_BASE` 以指定 API 伺服位址（見下節環境變數說明）。

## 使用者權限與角色說明

本專案實作了基本的登入機制與角色權限控管：

* **登入機制**：使用者需透過 `/login` 頁面登入，提交電子郵件與密碼後，由後端驗證帳密。驗證成功後，後端會回傳一組 JWT **權杖** (`token`) 以及使用者資訊 (`user`)。前端將 JWT token 保存於 `localStorage`，使用者資訊（包含角色）則保存於 Pinia 的 auth 狀態中。保存 JWT 的同時，也會在 `sessionStorage` 紀錄使用者角色，以便在頁面重新整理或未載入 Store 時仍能判斷權限。
* **角色類型**：系統預定義了三種角色（role）：

  * **admin（最高管理員）**：擁有系統中的所有操作權限。管理員可以訪問系統設定與使用者管理等所有功能。
  * **manager（一般管理者）**：擁有管理車隊與資料分析的權限。管理者可查看車輛、電池、警報等所有數據，並可能執行車輛管理等操作，但不一定具有使用者帳號管理權。
  * **user（一般使用者）**：僅能讀取資料。普通用戶通常只能查看與自身相關的資訊或一般公開的車隊數據，不能進行敏感設定變更。
* **頁面權限控制**：透過 Vue Router 的全域導航守衛實現路由保護。在進入每個路由前，會檢查該路由的 `meta.requiresAuth` 標記，若需要登入而目前未登入，則自動導向登入頁。對於標記了 `meta.requiresAdmin` 的路由（例如使用者管理頁 `/admin/users`），守衛會進一步檢查當前使用者是否為 admin 身份；若非 admin 則中止導航並轉向「403 Forbidden」提示頁。這可確保只有具有管理員權限的使用者才能存取後臺管理功能。
* **功能權限**：前端界面也會根據角色動態調整。比如，一般使用者在導航選單中不會看到管理專區的頁面鏈接；而管理員登入後則可以看到並訪問「使用者與角色管理」等功能頁面。角色資訊由後端提供，在成功登入後前端即可據此決定顯示內容。

> 💡 *注意：目前前端針對管理員以外角色的細粒度權限控制較為簡單。例如 `manager` 與 `user` 角色在介面上的可操作範圍目前並未做明顯區隔，但後端可透過 `scopes` 等欄位來定義更細的API權限。開發者可在未來根據需要加強不同角色的資料存取限制。*

## 環境變數設定與部署指引

專案中使用了一些環境變數來配置地圖服務、Mock 開關以及 API 位址。這些變數需要在部署前妥善設置：

| 環境變數                   | 說明                                                                                                          | 範例值                       |
| ---------------------- | ----------------------------------------------------------------------------------------------------------- | ------------------------- |
| `VITE_GOOGLE_MAPS_KEY` | **Google Maps API 金鑰**。Live Map 地圖功能需要此金鑰授權。                                                                | （例如：`AIzaSyD...`）         |
| `VITE_ENABLE_MOCK`     | **啟用模擬 API 開關**。設為 `"true"` 時，即使在非開發環境也啟用 MSW 模擬後端。預設開發模式下已自動為 true。生產環境若沒有真實後端，可暫時開啟此選項以使用假資料。             | `"true"` 或 `"false"`      |
| `VITE_API_BASE`        | **後端 API 根網址**。提供實際後端 API 的完整域名或路徑。如將前端部署在純靜態主機且後端有不同網域時，需要設置此值以讓前端知道請求的 API 位址前綴。若留空，預設採用相對路徑呼叫（假設與前端同網域）。 | `https://api.example.com` |

請將上述變數加入專案根目錄的 `.env` 檔案中（此檔案不應提交至版本庫）。Vite 會在編譯時讀取 `VITE_` 前綴的變數。**注意**：環境變數的作用域各有不同，其中 `VITE_GOOGLE_MAPS_KEY` 於前端程式碼中使用（會公開在前端 JavaScript 中）；敏感的金鑰請謹慎公開。`VITE_ENABLE_MOCK` 可用於控制部署後是否啟用模擬數據（通常生產環境應關閉）。`VITE_API_BASE` 在需要跨網域調用 API 時設定，可搭配反向代理或 CORS 一起使用。

部署指引：

* **開發環境**：開發時將 `.env` 中的變數填好後，直接執行 `npm run dev` 即可。MSW 模擬服務會在開發伺服器啟動時自動載入。
* **建置與部署**：生產部署前請確認已設置正確的環境變數值，再執行 `npm run build` 產生靜態檔案。若使用 Docker，確保在 `docker build` 時 `.env` 已包含所需變數（Dockerfile 會在建置期間將變數編譯進去前端程式）。建置完成後：

  * **容器部署**：按照前述 Docker Compose 或 docker 命令將容器部署到您的伺服環境。可將服務設定為開機自啟，並使用 `restart: unless-stopped` 等參數確保容器穩定長期執行。
  * **靜態主機部署**：將 `dist/` 內的所有檔案上傳至您的靜態網站代管服務（如 AWS S3 + CloudFront、Netlify、GitHub Pages 等）或自行架設的 Nginx/Apache 伺服器的對應目錄。確保後端 API 可被前端網域存取，必要時在前端部署處理跨域設定或在後端開放 CORS。

部署完成後，您應能透過瀏覽器訪問部署的網址，進入登入頁面並使用預設的帳密（若有提供）進行測試登入。由於本前端預設未內建後端資料庫，若您需要在生產環境使用真實資料，請同時部署並啟動對應的後端服務，或暫時啟用 `VITE_ENABLE_MOCK="true"` 以使用模擬資料進行展示。

## 測試方式

當前此專案**沒有整合特定的自動化測試框架**，因此沒有可直接執行的單元或整合測試指令。在開發過程中，可以透過瀏覽器手動操作來驗證各項功能的正確性。例如，啟動開發伺服器後嘗試登入不同角色帳戶，檢視對應頁面是否正確顯示，或切換地圖與圖表功能是否正常。

未來若需添加測試，建議可採用以下方式：

* **單元測試**：使用 Vitest 或 Jest 編寫 Vue 元件和函式的單元測試。可模擬 Pinia store 和 router，確保各個邏輯函式在隔離環境下運作如預期。
* **端對端測試**：使用 Cypress 等工具錄製使用者在瀏覽器中的操作路徑，以自動化測試整個應用流程（例如從登入到查看圖表的一系列操作）。
* **Lint/型別檢查**：專案已配置 TypeScript 型別檢查與（可選）ESLint 規則，在提交程式碼前可執行 `npm run build`（內含 `vue-tsc` 型別檢查）確保型別正確，以及使用 `eslint .` 檢查程式碼風格。

雖然目前尚未有自動化測試，但透過嚴謹的代碼審查和手動測試，本專案依然能保持一定的可靠性。一旦專案進入穩定階段，強烈建議補充相應的測試，以利於未來的維護與開發。

## 結語

以上即為 Penguin 儀表板專案的完整說明文件。本 README 涵蓋了專案的目的與功能介紹、技術棧、環境建置步驟、主要 API 介面、使用者權限區分、環境變數設定以及測試指引。開發者可依此文件快速了解並開始使用本專案。同時歡迎對此專案有興趣的開發者貢獻代碼或提出建議，一起優化電單車數據管理的開源解決方案。祝使用愉快，Happy Coding! 🚴‍♂️💨

**參考資料**：本說明內容根據專案原始碼進行撰寫。等相關檔案片段提供了技術實現與功能的依據。如需更深入了解實作細節，請參考專案的源碼。
