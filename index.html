<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>運動資料管理平台 </title>
    <!-- Handle chunk load failures gracefully -->
    <script>
      (function () {
        // Only handle dynamic import failures, not initial script loads
        window.addEventListener('unhandledrejection', function (e) {
          try {
            var msg = String(e && (e.reason && (e.reason.message || e.reason.name)) || '')
            // Only reload for chunk load errors, not other errors
            if (/ChunkLoadError|Loading chunk \d+ failed/i.test(msg)) {
              // Check if we already tried once this session
              var tried = sessionStorage.getItem('chunk-reload-tried');
              if (!tried) {
                sessionStorage.setItem('chunk-reload-tried', '1');
                // Simple reload without adding parameters
                window.location.reload(true);
              }
            }
          } catch (_) {}
        });

        // Clear flag on successful load
        window.addEventListener('load', function() {
          sessionStorage.removeItem('chunk-reload-tried');
        });
      })();
    </script>
  </head>
  <body>
    <div id="app"></div>
    <!-- Runtime config (public + secret) loaded before app -->
    <script src="/config/config.public.js?v=%CONFIG_VERSION%"></script>
    <script src="/config/config.secret.js?v=%CONFIG_VERSION%"></script>
    <!-- CryptoJS (AES + HMAC-SHA256) for client-side Fernet without WebCrypto -->
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
