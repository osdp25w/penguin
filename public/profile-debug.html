<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å€‹äººè³‡æ–™é™¤éŒ¯</title>
  <style>
    body { font-family: system-ui; padding: 20px; max-width: 1000px; margin: 0 auto; }
    .test-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .info { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .code-block { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
    .data-section { margin: 20px 0; }
  </style>
</head>
<body>
  <h1>ğŸ› å€‹äººè³‡æ–™é™¤éŒ¯å·¥å…·</h1>
  
  <div class="test-section">
    <h3>ğŸ“‹ æª¢æŸ¥æµç¨‹</h3>
    <ol>
      <li>ç™»å…¥ä¸¦æª¢æŸ¥ API å›æ‡‰çµæ§‹</li>
      <li>æª¢æŸ¥ localStorage ä¸­ä¿å­˜çš„ profile</li>
      <li>æª¢æŸ¥ auth store ä¸­çš„ç”¨æˆ¶è³‡æ–™</li>
      <li>åˆ†æç¼ºå¤±çš„æ¬„ä½</li>
    </ol>
  </div>

  <div>
    <button onclick="debugAdminProfile()">é™¤éŒ¯ Admin è³‡æ–™</button>
    <button onclick="debugMemberProfile()">é™¤éŒ¯ Member è³‡æ–™</button>
    <button onclick="clearAll()">æ¸…é™¤è³‡æ–™</button>
  </div>

  <div id="result"></div>
  <div id="debugInfo"></div>

  <script type="module">
    const result = document.getElementById('result');
    const debugInfo = document.getElementById('debugInfo');
    
    let authStore = null;
    
    // é™¤éŒ¯ Admin è³‡æ–™
    window.debugAdminProfile = async () => {
      try {
        // æ¸…ç†
        localStorage.clear();
        sessionStorage.clear();
        result.innerHTML = '<div class="info">ğŸ” æ­£åœ¨é™¤éŒ¯ Admin è³‡æ–™...</div>';
        debugInfo.innerHTML = '';
        
        // æ‰‹å‹•å‘¼å«ç™»å…¥ API ä¾†æŸ¥çœ‹å®Œæ•´å›æ‡‰
        result.innerHTML += '<div class="info">æ­¥é©Ÿ 1: æ‰‹å‹•å‘¼å«ç™»å…¥ API...</div>';
        
        const loginResponse = await fetch('/koala/api/account/auth/login/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: 'pony@admin1.com',
            password: 'gAAAAABm2BKJQkywC7LdRRb4PBV8T7S3E_7-qEZWnhVhKdNrT3R2Hqf8OOpQ_GRwQKJmX0dn3m3t4gT8C7KvkZVDcXLwE2Hn_A=='
          })
        });
        
        if (!loginResponse.ok) {
          throw new Error(\`ç™»å…¥ API å¤±æ•—: \${loginResponse.status}\`);
        }
        
        const loginData = await loginResponse.json();
        console.log('å®Œæ•´ç™»å…¥å›æ‡‰:', loginData);
        
        let html = '<div class="data-section">';
        html += '<h4>ğŸ” å®Œæ•´ç™»å…¥ API å›æ‡‰</h4>';
        html += \`<div class="code-block">\${JSON.stringify(loginData, null, 2)}</div>\`;
        html += '</div>';
        
        // ä½¿ç”¨ auth store ç™»å…¥
        result.innerHTML += '<div class="info">æ­¥é©Ÿ 2: ä½¿ç”¨ auth store ç™»å…¥...</div>';
        
        const { useAuth } = await import('/src/stores/auth.ts');
        authStore = useAuth();
        await authStore.login('pony@admin1.com', '2m8N625cvmf0');
        
        // æª¢æŸ¥ localStorage ä¸­çš„ profile
        const storedProfile = localStorage.getItem('penguin.user');
        const parsedProfile = storedProfile ? JSON.parse(storedProfile) : null;
        
        html += '<div class="data-section">';
        html += '<h4>ğŸ’¾ localStorage ä¸­çš„ Profile</h4>';
        html += \`<div class="code-block">\${JSON.stringify(parsedProfile, null, 2)}</div>\`;
        html += '</div>';
        
        // æª¢æŸ¥ auth store ä¸­çš„ç”¨æˆ¶
        html += '<div class="data-section">';
        html += '<h4>ğŸª Auth Store ä¸­çš„ç”¨æˆ¶è³‡æ–™</h4>';
        html += \`<div class="code-block">\${JSON.stringify(authStore.user, null, 2)}</div>\`;
        html += '</div>';
        
        // åˆ†æç¼ºå¤±æ¬„ä½
        html += '<div class="data-section">';
        html += '<h4>ğŸ” æ¬„ä½åˆ†æ</h4>';
        html += '<ul>';
        html += \`<li><strong>phone:</strong> API: \${loginData?.data?.profile?.phone || 'ç„¡'}, Store: \${authStore.user?.phone || 'ç„¡'}</li>\`;
        html += \`<li><strong>national_id:</strong> API: \${loginData?.data?.profile?.national_id || 'ç„¡'}, Store: \${authStore.user?.idNumber || 'ç„¡'}</li>\`;
        html += \`<li><strong>full_name:</strong> API: \${loginData?.data?.profile?.full_name || 'ç„¡'}, Store: \${authStore.user?.name || 'ç„¡'}</li>\`;
        html += '</ul>';
        html += '</div>';
        
        debugInfo.innerHTML = html;
        result.innerHTML += '<div class="success">âœ… Admin é™¤éŒ¯å®Œæˆ</div>';
        
      } catch (err) {
        result.innerHTML += \`<div class="error">âŒ Admin é™¤éŒ¯å¤±æ•—ï¼š\${err.message}</div>\`;
        console.error('Admin debug error:', err);
      }
    };
    
    // é™¤éŒ¯ Member è³‡æ–™  
    window.debugMemberProfile = async () => {
      try {
        // æ¸…ç†
        localStorage.clear();
        sessionStorage.clear();
        result.innerHTML = '<div class="info">ğŸ” æ­£åœ¨é™¤éŒ¯ Member è³‡æ–™...</div>';
        debugInfo.innerHTML = '';
        
        // æ‰‹å‹•å‘¼å«ç™»å…¥ API
        result.innerHTML += '<div class="info">æ­¥é©Ÿ 1: æ‰‹å‹•å‘¼å«ç™»å…¥ API...</div>';
        
        const loginResponse = await fetch('/koala/api/account/auth/login/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: 'pony_member_real1',
            password: 'gAAAAABm2BKJQkywC7LdRRb4PBV8T7S3E_7-qEZWnhVhKdNrT3R2Hqf8OOpQ_GRwQKJmX0dn3m3t4gT8C7KvkZVDcXLwE2Hn_A=='
          })
        });
        
        if (!loginResponse.ok) {
          throw new Error(\`ç™»å…¥ API å¤±æ•—: \${loginResponse.status}\`);
        }
        
        const loginData = await loginResponse.json();
        console.log('å®Œæ•´ç™»å…¥å›æ‡‰:', loginData);
        
        let html = '<div class="data-section">';
        html += '<h4>ğŸ” å®Œæ•´ç™»å…¥ API å›æ‡‰</h4>';
        html += \`<div class="code-block">\${JSON.stringify(loginData, null, 2)}</div>\`;
        html += '</div>';
        
        // ä½¿ç”¨ auth store ç™»å…¥
        result.innerHTML += '<div class="info">æ­¥é©Ÿ 2: ä½¿ç”¨ auth store ç™»å…¥...</div>';
        
        const { useAuth } = await import('/src/stores/auth.ts');
        authStore = useAuth();
        await authStore.login('pony_member_real1', '2m8N625cvmf0');
        
        // æª¢æŸ¥ localStorage ä¸­çš„ profile
        const storedProfile = localStorage.getItem('penguin.user');
        const parsedProfile = storedProfile ? JSON.parse(storedProfile) : null;
        
        html += '<div class="data-section">';
        html += '<h4>ğŸ’¾ localStorage ä¸­çš„ Profile</h4>';
        html += \`<div class="code-block">\${JSON.stringify(parsedProfile, null, 2)}</div>\`;
        html += '</div>';
        
        // æª¢æŸ¥ auth store ä¸­çš„ç”¨æˆ¶
        html += '<div class="data-section">';
        html += '<h4>ğŸª Auth Store ä¸­çš„ç”¨æˆ¶è³‡æ–™</h4>';
        html += \`<div class="code-block">\${JSON.stringify(authStore.user, null, 2)}</div>\`;
        html += '</div>';
        
        // åˆ†æç¼ºå¤±æ¬„ä½
        html += '<div class="data-section">';
        html += '<h4>ğŸ” æ¬„ä½åˆ†æ</h4>';
        html += '<ul>';
        html += \`<li><strong>phone:</strong> API: \${loginData?.data?.profile?.phone || 'ç„¡'}, Store: \${authStore.user?.phone || 'ç„¡'}</li>\`;
        html += \`<li><strong>national_id:</strong> API: \${loginData?.data?.profile?.national_id || 'ç„¡'}, Store: \${authStore.user?.idNumber || 'ç„¡'}</li>\`;
        html += \`<li><strong>full_name:</strong> API: \${loginData?.data?.profile?.full_name || 'ç„¡'}, Store: \${authStore.user?.name || 'ç„¡'}</li>\`;
        html += '</ul>';
        html += '</div>';
        
        debugInfo.innerHTML = html;
        result.innerHTML += '<div class="success">âœ… Member é™¤éŒ¯å®Œæˆ</div>';
        
      } catch (err) {
        result.innerHTML += \`<div class="error">âŒ Member é™¤éŒ¯å¤±æ•—ï¼š\${err.message}</div>\`;
        console.error('Member debug error:', err);
      }
    };
    
    window.clearAll = () => {
      localStorage.clear();
      sessionStorage.clear();
      result.innerHTML = '';
      debugInfo.innerHTML = '';
      authStore = null;
    };
  </script>
</body>
</html>