<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å€‹äººè³‡æ–™æ¸¬è©¦</title>
  <style>
    body { font-family: system-ui; padding: 20px; max-width: 1000px; margin: 0 auto; }
    .test-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .info { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .warning { background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .user-info { background: #e7f3ff; padding: 15px; border-radius: 5px; margin: 10px 0; }
    .test-form { background: white; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; margin: 20px 0; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .form-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>ğŸ”§ å€‹äººè³‡æ–™ä¿®æ”¹æ¸¬è©¦</h1>
  
  <div class="test-section">
    <h3>ğŸ“‹ æ¸¬è©¦èªªæ˜</h3>
    <p>æ¸¬è©¦ä¸åŒè§’è‰²çš„å€‹äººè³‡æ–™ä¿®æ”¹åŠŸèƒ½ï¼š</p>
    <ol>
      <li>Admin å¸³è™Ÿï¼ˆpony@admin1.comï¼‰- ä½¿ç”¨ staff API</li>
      <li>Member å¸³è™Ÿï¼ˆpony_member_real1ï¼‰- ä½¿ç”¨ members API</li>
      <li>æª¢æŸ¥ updateMe åŠŸèƒ½æ˜¯å¦æ­£å¸¸é‹ä½œ</li>
    </ol>
  </div>

  <div>
    <button onclick="testAdminProfile()">æ¸¬è©¦ Admin å€‹äººè³‡æ–™</button>
    <button onclick="testMemberProfile()">æ¸¬è©¦ Member å€‹äººè³‡æ–™</button>
    <button onclick="clearAll()">æ¸…é™¤æ¸¬è©¦</button>
  </div>

  <div id="result"></div>
  <div id="userInfo"></div>
  <div id="testForm"></div>

  <script type="module">
    const result = document.getElementById('result');
    const userInfo = document.getElementById('userInfo');
    const testForm = document.getElementById('testForm');
    
    let authStore = null;
    
    // æ¸¬è©¦ Admin å€‹äººè³‡æ–™åŠŸèƒ½
    window.testAdminProfile = async () => {
      try {
        // æ¸…ç†
        localStorage.clear();
        sessionStorage.clear();
        result.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æ¸¬è©¦ Admin å€‹äººè³‡æ–™åŠŸèƒ½...</div>';
        userInfo.innerHTML = '';
        testForm.innerHTML = '';
        
        // ç™»å…¥ Admin
        const { useAuth } = await import('/src/stores/auth.ts');
        authStore = useAuth();
        
        console.log('ç™»å…¥ pony@admin1.com...');
        await authStore.login('pony@admin1.com', '2m8N625cvmf0');
        
        // é¡¯ç¤ºç”¨æˆ¶è³‡æ–™
        displayUserInfo(authStore.user);
        
        // å‰µå»ºæ¸¬è©¦è¡¨å–®
        createTestForm();
        
        result.innerHTML = '<div class="success">âœ… Admin ç™»å…¥æˆåŠŸï¼å¯ä»¥é–‹å§‹æ¸¬è©¦å€‹äººè³‡æ–™ä¿®æ”¹</div>';
        
      } catch (err) {
        result.innerHTML = \`<div class="error">âŒ Admin æ¸¬è©¦å¤±æ•—ï¼š\${err.message}</div>\`;
        console.error('Admin profile test error:', err);
      }
    };
    
    // æ¸¬è©¦ Member å€‹äººè³‡æ–™åŠŸèƒ½
    window.testMemberProfile = async () => {
      try {
        // æ¸…ç†
        localStorage.clear();
        sessionStorage.clear();
        result.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æ¸¬è©¦ Member å€‹äººè³‡æ–™åŠŸèƒ½...</div>';
        userInfo.innerHTML = '';
        testForm.innerHTML = '';
        
        // ç™»å…¥ Member
        const { useAuth } = await import('/src/stores/auth.ts');
        authStore = useAuth();
        
        console.log('ç™»å…¥ pony_member_real1...');
        await authStore.login('pony_member_real1', '2m8N625cvmf0');
        
        // é¡¯ç¤ºç”¨æˆ¶è³‡æ–™
        displayUserInfo(authStore.user);
        
        // å‰µå»ºæ¸¬è©¦è¡¨å–®
        createTestForm();
        
        result.innerHTML = '<div class="success">âœ… Member ç™»å…¥æˆåŠŸï¼å¯ä»¥é–‹å§‹æ¸¬è©¦å€‹äººè³‡æ–™ä¿®æ”¹</div>';
        
      } catch (err) {
        result.innerHTML = \`<div class="error">âŒ Member æ¸¬è©¦å¤±æ•—ï¼š\${err.message}</div>\`;
        console.error('Member profile test error:', err);
      }
    };
    
    // é¡¯ç¤ºç”¨æˆ¶è³‡æ–™
    function displayUserInfo(user) {
      if (!user) {
        userInfo.innerHTML = '<div class="warning">âš ï¸ æ²’æœ‰ç”¨æˆ¶è³‡æ–™</div>';
        return;
      }
      
      let html = '<div class="user-info">';
      html += '<h4>ğŸ“‹ ç›®å‰ç”¨æˆ¶è³‡æ–™</h4>';
      html += \`<p><strong>IDï¼š</strong>\${user.id || 'ç„¡'}</p>\`;
      html += \`<p><strong>å§“åï¼š</strong>\${user.name || 'ç„¡'}</p>\`;
      html += \`<p><strong>Emailï¼š</strong>\${user.email || 'ç„¡'}</p>\`;
      html += \`<p><strong>è§’è‰²ï¼š</strong>\${user.roleId || 'ç„¡'}</p>\`;
      html += \`<p><strong>æ‰‹æ©Ÿï¼š</strong>\${user.phone || 'ç„¡'}</p>\`;
      html += \`<p><strong>èº«ä»½è­‰ï¼š</strong>\${user.idNumber || 'ç„¡'}</p>\`;
      html += \`<p><strong>é ­åƒï¼š</strong>\${user.avatarUrl || 'ç„¡'}</p>\`;
      html += '</div>';
      
      userInfo.innerHTML = html;
    }
    
    // å‰µå»ºæ¸¬è©¦è¡¨å–®
    function createTestForm() {
      let html = '<div class="test-form">';
      html += '<h4>ğŸ§ª å€‹äººè³‡æ–™ä¿®æ”¹æ¸¬è©¦</h4>';
      html += '<div class="form-group">';
      html += '<label>å§“åï¼š</label>';
      html += \`<input type="text" id="testName" value="\${authStore?.user?.name || ''}" />\`;
      html += '</div>';
      html += '<div class="form-group">';
      html += '<label>é›»è©±ï¼š</label>';
      html += \`<input type="tel" id="testPhone" value="\${authStore?.user?.phone || ''}" />\`;
      html += '</div>';
      html += '<div class="form-group">';
      html += '<label>Emailï¼š</label>';
      html += \`<input type="email" id="testEmail" value="\${authStore?.user?.email || ''}" />\`;
      html += '</div>';
      html += '<div class="form-group">';
      html += '<label>èº«ä»½è­‰è™Ÿï¼š</label>';
      html += \`<input type="text" id="testIdNumber" value="\${authStore?.user?.idNumber || ''}" maxlength="10" placeholder="A123456789" />\`;
      html += '</div>';
      html += '<div class="form-group">';
      html += '<button onclick="testUpdateProfile()">ğŸ”„ æ¸¬è©¦æ›´æ–°å€‹äººè³‡æ–™</button>';
      html += '</div>';
      html += '</div>';
      
      testForm.innerHTML = html;
    }
    
    // æ¸¬è©¦æ›´æ–°å€‹äººè³‡æ–™
    window.testUpdateProfile = async () => {
      if (!authStore) {
        result.innerHTML = '<div class="error">âŒ è«‹å…ˆç™»å…¥</div>';
        return;
      }
      
      try {
        const name = document.getElementById('testName').value;
        const phone = document.getElementById('testPhone').value;
        const email = document.getElementById('testEmail').value;
        const idNumber = document.getElementById('testIdNumber').value;
        
        result.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨æ›´æ–°å€‹äººè³‡æ–™...</div>';
        
        const payload = {
          name: name,
          phone: phone,
          email: email,
          idNumber: idNumber || undefined
        };
        
        console.log('Updating profile with payload:', payload);
        
        // å‘¼å« updateMe
        const updatedUser = await authStore.updateMe(payload);
        
        console.log('Updated user:', updatedUser);
        
        // é‡æ–°é¡¯ç¤ºç”¨æˆ¶è³‡æ–™
        displayUserInfo(updatedUser);
        
        result.innerHTML = '<div class="success">âœ… å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸï¼</div>';
        
      } catch (err) {
        result.innerHTML = \`<div class="error">âŒ å€‹äººè³‡æ–™æ›´æ–°å¤±æ•—ï¼š\${err.message}</div>\`;
        console.error('Profile update error:', err);
      }
    };
    
    window.clearAll = () => {
      localStorage.clear();
      sessionStorage.clear();
      result.innerHTML = '';
      userInfo.innerHTML = '';
      testForm.innerHTML = '';
      authStore = null;
    };
  </script>
</body>
</html>