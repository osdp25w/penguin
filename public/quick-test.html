<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>快速登入測試</title>
  <style>
    body { font-family: system-ui; padding: 20px; max-width: 600px; margin: 0 auto; }
    input { width: 100%; padding: 8px; margin: 5px 0; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    button:hover { background: #e0e0e0; }
    #result { margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; white-space: pre-wrap; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <h1>登入測試</h1>
  
  <div>
    <input id="email" placeholder="Email" value="pony@tourist3.com">
    <input id="password" type="password" placeholder="密碼" value="2m8N625cvmf0">
    <div>
      <button onclick="testActualLogin()">測試實際登入流程</button>
      <button onclick="testDirectAPI()">直接測試 API (用 Token)</button>
    </div>
  </div>

  <div id="result"></div>

  <script type="module">
    const result = document.getElementById('result');
    
    // Test actual login flow (mimics what the app does)
    window.testActualLogin = async () => {
      try {
        result.textContent = '正在測試登入流程...\n';
        result.className = '';
        
        // Import the actual Koala service
        const { Koala } = await import('/src/services/koala.ts');
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        result.textContent += `Email: ${email}\n`;
        result.textContent += `密碼: ${password.substring(0, 3)}***\n\n`;
        result.textContent += '呼叫 Koala.login()...\n';
        
        const response = await Koala.login(email, password);
        
        if (response.access) {
          result.textContent += '\n✅ 登入成功!\n\n';
          result.textContent += `Access Token: ${response.access.substring(0, 50)}...\n`;
          if (response.profile) {
            result.textContent += `用戶: ${response.profile.email}\n`;
            result.textContent += `ID: ${response.profile.id}\n`;
            result.textContent += `類型: ${response.profile.profile_type || response.profile.type}\n`;
          }
          result.className = 'success';
        } else {
          result.textContent += '\n❌ 登入失敗：沒有收到 token\n';
          result.className = 'error';
        }
      } catch (err) {
        result.textContent += `\n❌ 錯誤: ${err.message}\n`;
        result.textContent += `\n詳細資訊:\n${err.stack}`;
        result.className = 'error';
        
        // Check console for more details
        console.error('Login error:', err);
      }
    };
    
    // Test with pre-encrypted token
    window.testDirectAPI = async () => {
      try {
        result.textContent = '使用預先加密的 token 測試...\n';
        result.className = '';
        
        const token = 'gAAAAABouquWBZMFmRDZn1Yq2nbF9xfVjy3mKiSXbDqX0BKA5SRCqSr0BO7zO9yajdnq78rr1GWrAdxgSAtpVsKIL1oaaV-16w==';
        
        const res = await fetch('/koala/api/account/auth/login/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: document.getElementById('email').value,
            password: token
          })
        });
        
        const data = await res.json();
        
        if (data.code === 2000) {
          result.textContent += '\n✅ API 測試成功!\n\n';
          result.textContent += JSON.stringify(data, null, 2);
          result.className = 'success';
        } else {
          result.textContent += '\n❌ API 測試失敗\n\n';
          result.textContent += JSON.stringify(data, null, 2);
          result.className = 'error';
        }
      } catch (err) {
        result.textContent += `\n❌ 錯誤: ${err.message}`;
        result.className = 'error';
      }
    };
  </script>
</body>
</html>